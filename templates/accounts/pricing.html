{% extends 'base.html' %}

{% block title %}Pricing - EyeHealth 20-20-20{% endblock %}

{% block content %}
<div class="container mt-5">
    <!-- Header -->
    <div class="row text-center mb-5">
        <div class="col-lg-8 mx-auto">
            <h1 class="display-4 fw-bold mb-3">Choose Your Plan</h1>
            <p class="lead text-muted">
                Start free and upgrade when you're ready. All plans include the core 20-20-20 timer functionality.
            </p>
        </div>
    </div>

    <!-- Pricing Cards -->
    <div class="row justify-content-center g-4 mb-5">
        <!-- Free Plan -->
        <div class="col-lg-5 col-md-6">
            <div class="card h-100 border-0 shadow">
                <div class="card-header bg-light text-center border-0 py-4">
                    <h3 class="card-title">Free</h3>
                    <div class="display-4 fw-bold">$0</div>
                    <small class="text-muted">Forever free</small>
                </div>
                <div class="card-body p-4">
                    <ul class="list-unstyled">
                        {% for feature in features_comparison.free %}
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>{{ feature }}
                        </li>
                        {% endfor %}
                        <li class="mb-2 text-muted">
                            <i class="fas fa-times text-muted me-2"></i>Advanced analytics
                        </li>
                        <li class="mb-2 text-muted">
                            <i class="fas fa-times text-muted me-2"></i>Custom break messages
                        </li>
                        <li class="mb-2 text-muted">
                            <i class="fas fa-times text-muted me-2"></i>Unlimited intervals
                        </li>
                        <li class="mb-2 text-muted">
                            <i class="fas fa-times text-muted me-2"></i>Priority support
                        </li>
                    </ul>
                </div>
                <div class="card-footer bg-transparent border-0 p-4">
                    {% if user.is_authenticated %}
                        {% if user.subscription_type == 'free' %}
                            <button class="btn btn-outline-primary w-100" disabled>
                                <i class="fas fa-check me-2"></i>Current Plan
                            </button>
                        {% else %}
                            <a href="#" class="btn btn-outline-primary w-100">
                                <i class="fas fa-arrow-down me-2"></i>Downgrade
                            </a>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'accounts:signup' %}" class="btn btn-outline-primary w-100">
                            <i class="fas fa-rocket me-2"></i>Get Started Free
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Premium Plan -->
        <div class="col-lg-5 col-md-6">
            <div class="card h-100 border-warning shadow" style="transform: scale(1.05);">
                <div class="position-absolute top-0 start-50 translate-middle">
                    <span class="badge bg-warning text-dark px-3 py-2">MOST POPULAR</span>
                </div>
                <div class="card-header bg-warning text-dark text-center border-0 py-4">
                    <h3 class="card-title">Premium</h3>
                    <div class="display-4 fw-bold">$0.99</div>
                    <small>per month</small>
                    <div class="mt-2">
                        <small class="text-muted">
                            <strong>Professional eye health tracking</strong>
                        </small>
                    </div>
                </div>
                <div class="card-body p-4">
                    <ul class="list-unstyled">
                        {% for feature in features_comparison.premium %}
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>{{ feature }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="card-footer bg-transparent border-0 p-4">
                    {% if user.is_authenticated %}
                        {% if user.subscription_type == 'premium' %}
                            <button class="btn btn-warning w-100" disabled>
                                <i class="fas fa-check me-2"></i>Current Plan
                            </button>
                        {% else %}
                            <a href="{% url 'payments:upgrade_premium' %}" class="btn btn-warning w-100">
                                <i class="fas fa-crown me-2"></i>Upgrade to Premium
                            </a>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'accounts:signup' %}" class="btn btn-warning w-100">
                            <i class="fas fa-crown me-2"></i>Try Premium
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

    </div>

    <!-- FAQ Section -->
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <h2 class="text-center mb-4">Frequently Asked Questions</h2>
            <div class="accordion" id="faqAccordion">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faq1">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1">
                            Is the 20-20-20 rule scientifically proven?
                        </button>
                    </h2>
                    <div id="collapse1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            Yes! The 20-20-20 rule is recommended by the American Academy of Ophthalmology and supported by research showing it can significantly reduce digital eye strain symptoms.
                        </div>
                    </div>
                </div>
                
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faq2">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2">
                            Can I cancel my subscription anytime?
                        </button>
                    </h2>
                    <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            Absolutely! You can cancel your subscription at any time. Your account will remain active until the end of your billing period, then automatically revert to the free plan.
                        </div>
                    </div>
                </div>
                
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faq3">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3">
                            Do you offer refunds?
                        </button>
                    </h2>
                    <div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            Yes, we offer a 30-day money-back guarantee for all paid plans. If you're not satisfied, contact our support team for a full refund.
                        </div>
                    </div>
                </div>
                
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faq4">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse4">
                            Is my data secure?
                        </button>
                    </h2>
                    <div id="collapse4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            Your privacy and security are our top priorities. We use industry-standard encryption, comply with GDPR regulations, and never share your personal data with third parties.
                        </div>
                    </div>
                </div>
                
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faq5">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse5">
                            Can I use this on multiple devices?
                        </button>
                    </h2>
                    <div id="collapse5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            Yes! Your account works across all devices - desktop, tablet, and mobile. Your progress and settings sync automatically across all platforms.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Final CTA -->
    <div class="row mt-5">
        <div class="col-lg-8 mx-auto text-center">
            <div class="bg-light p-5 rounded">
                <h3 class="mb-3">Ready to protect your vision?</h3>
                <p class="text-muted mb-4">
                    Join thousands of users who have reduced their digital eye strain with our scientifically-backed timer system.
                </p>
                <div class="d-flex flex-column flex-md-row justify-content-center gap-3">
                    {% if not user.is_authenticated %}
                        <a href="{% url 'accounts:signup' %}" class="btn btn-primary btn-lg">
                            <i class="fas fa-rocket me-2"></i>Start Free Today
                        </a>
                    {% endif %}
                    <a href="#" class="btn btn-outline-primary btn-lg">
                        <i class="fas fa-question-circle me-2"></i>Contact Support
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Countdown Timer
        function updateCountdown() {
            const endDate = new Date();
            endDate.setDate(endDate.getDate() + 7);
            endDate.setHours(23, 59, 59);

            const now = new Date();
            const timeDiff = endDate - now;

            if (timeDiff > 0) {
                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

                // Update both countdowns
                const elements = ['days', 'hours', 'minutes', 'seconds', 'final-days', 'final-hours', 'final-minutes', 'final-seconds'];
                const values = [days, hours, minutes, seconds, days, hours, minutes, seconds];

                elements.forEach((id, index) => {
                    const el = document.getElementById(id);
                    if (el) {
                        el.textContent = values[index].toString().padStart(2, '0');
                    }
                });
            }
        }

        updateCountdown();
        setInterval(updateCountdown, 1000);

        // Animate social proof numbers
        function animateCounters() {
            const counters = document.querySelectorAll('.user-count');
            const targets = [87, 24387, 96];

            counters.forEach((counter, index) => {
                const target = targets[index];
                let current = 0;
                const increment = target / 50;
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }

                    if (index === 0 || index === 2) {
                        counter.textContent = Math.floor(current) + '%';
                    } else {
                        counter.textContent = Math.floor(current).toLocaleString();
                    }
                }, 50);
            });
        }

        setTimeout(animateCounters, 1000);

        // Add hover effects to pricing cards
        document.querySelectorAll('.pricing-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = this.classList.contains('featured') ? 'scale(1.08)' : 'scale(1.03)';
            });

            card.addEventListener('mouseleave', function() {
                this.style.transform = this.classList.contains('featured') ? 'scale(1.05)' : 'scale(1)';
            });
        });
    });
</script>
{% endblock %}